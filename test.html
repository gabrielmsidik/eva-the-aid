<button onclick="start()">Start</button>
<input type="text" id='a' />
<button value="submit" onclick=dummy() />
<body id='b'>

</body>
<br />

<!-- <button onclick="stop()">Stop</button> -->

<script>

    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.interimResults = true;
    recognition.lang = 'en-US';

    function dummy() {
        let transcript = document.getElementById("a").value
        console.log(transcript)
        transcript = transcript.toLowerCase();
        if (transcript.toLowerCase().search("eva") >= 0) {
            let intents = processSpeech(transcript);
            processIntent(intents, transcript);
        }
    }

    function processIntent(intents, transcript) {
        let body = document.querySelector("#b");
        let p = document.createElement("p");
        let dt = new Date();
        p.textContent = dt.toUTCString() + " " + transcript;
        console.log(p);
        body.appendChild(p);
    }

    function processSpeech(speech) {
        console.log("processing speech... ")
        keywords = new Map(
            [['blood pressure', 'bp'],
            ['sugar level', 'sl']]);

        let l = []
        keywords.forEach((value, key, map) => {
            if (speech.search(key) > 0)  {
                console.log("speech registered:", speech)
                l.push(value);
            }
        })
        return l;

    }

    recognition.onresult = (e) => {
        let transcript = Array.from(e.results)
            .map(result => result[0])
            .map(result => result.transcript)
            .join('')
        if (e.results[0].isFinal) {
            if (transcript.toLowerCase().search("eva")) {
                processSpeech(transcript.toLowerCase());
                transcript = transcript.toLowerCase();
                if (transcript.toLowerCase().search("eva") >= 0) {
                    let intents = processSpeech(transcript);
                    processIntent(intents, transcript);
                }
            }
            console.log(transcript);
            //put it here
        }
    }
    recognition.addEventListener('end', recognition.start);
    // recognition.onspeechend = function () {
    //     recognition.stop()
    //     recognition.start()
    //     console.log("here")
    //     // recognition.start();//start to always listen
    // }

    function start() {
        console.log("start");

        recognition.start();
    }

    function enterInput(el) {
        console.log(el.textContent);
    }

</script>